<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form - CareConnect</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/form.css" />
  </head>
  <body>
    <div class="top-container">
      <header>
        <h1 class="logo">
          <span class="blue-c">C</span>are<span class="blue-c">C</span>onnect
        </h1>
      </header>
    </div>

    <div class="form-container">
      <form id="infoForm" onsubmit="submitForm(event)">
        <div class="form-group">
          <label for="home">Home</label>
          <select id="home" required>
            <option value="">Select home</option>
            <option value="Home1">Home1</option>
            <option value="Home2">Home2</option>
            <option value="Home3">Home3</option>
            <option value="Home4">Home4</option>
          </select>
        </div>

        <div class="form-group">
          <label for="department">Department</label>
          <select id="department" required>
            <option value="">Select department</option>
            <option value="Dept 1">Dept 1</option>
            <option value="Dept 2">Dept 2</option>
            <option value="Dept 3">Dept 3</option>
          </select>
        </div>

        <div class="form-group name-designation-group">
          <div class="name-field">
            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Enter name" required />
          </div>
          <div class="designation-field">
            <label for="designation">Designation</label>
            <input
              type="text"
              id="designation"
              placeholder="Enter designation"
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label for="information">Information</label>
          <textarea
            id="information"
            placeholder="Enter information details"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="authorizedBy">Authorized By</label>
          <select id="authorizedBy" required>
            <option value="">Select authorizing person</option>
            <option value="Manager 1">Manager 1</option>
            <option value="Manager 2">Manager 2</option>
            <option value="Manager 3">Manager 3</option>
          </select>
        </div>

        <!-- Replace the send-to-box div with this -->
        <div class="form-group">
          <label for="sendTo">Send To</label>
          <select id="sendTo" required>
            <option value="">Select department</option>
            <option value="All">All</option>
            <option value="Catering">Catering</option>
            <option value="Outreach">Outreach</option>
            <option value="Reception">Reception</option>
            <option value="Dementia">Dementia</option>
            <option value="Housekeeping">Housekeeping</option>
            <option value="Admin Office">Admin Office</option>
          </select>
        </div>

        <div class="button-group">
          <button
            type="button"
            class="btn btn-back"
            onclick="window.location.href='index.html'"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button type="submit" class="btn btn-send">
            <i class="fas fa-paper-plane"></i> Send
          </button>
        </div>
      </form>
    </div>

    <script>
      // Get the type from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const type = urlParams.get("type") || "routine"; // Default to routine if no type specified

      // Add the type class to body
      document.body.classList.add(type);

      // Make chips selectable
      document.querySelectorAll(".option-chip").forEach((chip) => {
        chip.addEventListener("click", function () {
          if (this.textContent === "All") {
            // Handle 'All' chip
            const isSelected = !this.classList.contains("selected");
            document.querySelectorAll(".option-chip").forEach((c) => {
              if (isSelected) {
                c.classList.add("selected");
              } else {
                c.classList.remove("selected");
              }
            });
          } else {
            // Handle other chips
            this.classList.toggle("selected");

            // Check if all individual chips are selected
            const allChip = document.querySelector(".option-chip:first-child");
            const otherChips = document.querySelectorAll(
              ".option-chip:not(:first-child)"
            );
            const allSelected = Array.from(otherChips).every((c) =>
              c.classList.contains("selected")
            );

            if (allSelected) {
              allChip.classList.add("selected");
            } else {
              allChip.classList.remove("selected");
            }
          }
        });
      });

      // Form submission handler
      // Add this to your form.html or a separate JavaScript file
      async function submitForm(event) {
        event.preventDefault();

        // Get the type from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const formType = urlParams.get("type") || "routine"; // Default to routine if no type specified

        // Generate job ID
        const now = new Date();
        const year = now.getFullYear().toString().slice(-2);
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const random = Math.floor(Math.random() * 10000)
          .toString()
          .padStart(4, "0");
        const jobId = `J${year}${month}${day}${random}`;

        const formData = {
          job_id: jobId,
          home: document.getElementById("home").value,
          department: document.getElementById("department").value,
          name: document.getElementById("name").value,
          designation: document.getElementById("designation").value,
          information: document.getElementById("information").value,
          authorized_by: document.getElementById("authorizedBy").value,
          send_to: document.getElementById("sendTo").value, // Direct value from dropdown
          type: formType, // Use the type from URL
          status: "pending",
        };

        try {
          const response = await fetch("/api/save-info", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          const result = await response.json();

          if (!response.ok) {
            throw new Error(result.message || "Failed to save information");
          }

          alert("Information submitted successfully!");
          document.getElementById("infoForm").reset();
        } catch (error) {
          console.error("Error submitting form:", error);
          alert(
            error.message || "Failed to submit information. Please try again."
          );
        }
      }
      // Add this to display the form type in the UI (optional)
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const formType = urlParams.get("type") || "routine";

        // You could add this to show what type of form is being filled
        const formTitle = document.querySelector(".form-title");
        if (formTitle) {
          formTitle.textContent = `${
            formType.charAt(0).toUpperCase() + formType.slice(1)
          } Information Form`;
        }
      });

      // Function to generate a unique job ID
      function generateJobId() {
        const timestamp = new Date().getTime();
        const random = Math.floor(Math.random() * 1000);
        return `JOB${timestamp}${random}`;
      }
    </script>
  </body>
</html>
